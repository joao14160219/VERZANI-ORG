<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Organograma Interativo</title>
  <script src="https://balkan.app/js/orgchart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<img src="/imgs/logo-verzani.png">
<div id="entradaContainer">
  <label for="entrada"><strong>INSIRA OS DADOS NO FORMATO:</strong> <br><small><code>NOME - CARGO - CLASSIFICAÇÃO ; CHEFE</code></small></label>
  <textarea id="entrada" placeholder="Exemplo:  
ANTONIO CAVALCANTI JUNIOR-CFO-02. VP ;FABIO SANDRINI BAPTISTA
FABIO PANHONI DE PAULA PEREIRA-DIRETOR M&A-03. Diretor ;ANTONIO CAVALCANTI JUNIOR"></textarea>
  <button onclick="gerarOrganograma()">GERAR ORGANOGRAMA</button>
</div>

<div id="organograma"></div>

<script>
  // Template baseado em "ula" com texto alinhado à esquerda e quebra automática
  OrgChart.templates.ulaLeft = Object.assign({}, OrgChart.templates.ula);
  OrgChart.templates.ulaLeft.size = [260, 110];
  OrgChart.templates.ulaLeft.node =
    '<rect x="0" y="0" width="260" height="110" fill="#F4F6F8" stroke="#ccc" rx="10" ry="10"></rect>' +
    '<foreignObject x="10" y="10" width="240" height="90">' +
      '<div xmlns="http://www.w3.org/1999/xhtml" style="font-family: Segoe UI; color: #222; font-size: 13px; line-height: 1.3;">' +
        '<div style="font-weight: bold; font-size: 15px;" data-field="name"></div>' +
        '<div data-field="cargo" style="margin-top: 4px;"></div>' +
        '<div data-field="classificacao" style="color: #555; font-size: 12px;"></div>' +
      '</div>' +
    '</foreignObject>';

  function gerarOrganograma() {
    const texto = document.getElementById("entrada").value;
    const linhas = texto.trim().split("\n");
    const nodes = [];

    linhas.forEach(linha => {
      if (linha.trim() === "") return;

      const partes = linha.trim().split(";");
      const dados = partes[0].trim().split("-");
      const nome = dados[0]?.trim();
      const cargo = dados[1]?.trim() || "";
      const classificacao = dados[2]?.trim() || "";
      const chefe = partes[1]?.trim();

      if (!nome) return;

      const node = {
        id: nome,
        name: nome,
        cargo: cargo,
        classificacao: classificacao
      };

      if (chefe && chefe !== nome) {
        node.pid = chefe;
      }

      nodes.push(node);
    });

    document.getElementById("organograma").innerHTML = "";

    new OrgChart(document.getElementById("organograma"), {
      nodes,
      template: "ulaLeft",
      nodeBinding: {
        field_0: "name",
        field_1: "cargo",
        field_2: "classificacao"
      }
    });
  }
</script>

</body>
</html>
